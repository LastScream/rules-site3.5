:root{
  --bg-1:#000f41;        /* фон */
  --bg-2:#0f1428;
  --panel:#181c33ee;     /* стекло */
  --panel-soft:#0e1224cc;
  --panel-blur:14px;
  --panel-border:#232a4a;

  --ink:#e6ebff;         /* текст */
  --muted:#9aa3c7;

  --primary:#6a7dff;     /* акценты */
  --accent:#55ffa1;
  --ok:#58ffa1;

  --radius:16px;
  --maxw:1080px;

  --logo-h: clamp(28px, 5vw, 85px); /* высота логотипа */
}

/* dark — как по умолчанию */

*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0;
  font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--ink);
  line-height:1.65;
  overflow-x:hidden;
}

/* ===== Фон ===== */
.bg{ position:fixed; inset:0; z-index:-2; background:linear-gradient(180deg,var(--bg-1),var(--bg-2)); }
.glow{ position:absolute; filter:blur(60px); opacity:.7; mix-blend-mode:screen; }
.glow-1{ width:60vw; height:60vh; top:-10vh; left:-10vw; background:radial-gradient(50% 50% at 50% 50%, #656ffd 0%, transparent 60%); }
.glow-2{ width:70vw; height:70vh; bottom:-20vh; right:-10vw; background:radial-gradient(50% 50% at 50% 50%, #5bfff1 0%, transparent 65%); }

/* Частицы */
.particles::before, .particles::after{
  content:""; position:absolute; inset:-10% -10% -10% -10%;
  background:
    radial-gradient(2px 2px at 20% 30%, #ffffff66 50%, transparent 51%),
    radial-gradient(2px 2px at 80% 60%, #ffffff4d 50%, transparent 51%),
    radial-gradient(1.5px 1.5px at 40% 80%, #ffffff4d 50%, transparent 51%),
    radial-gradient(1.5px 1.5px at 60% 20%, #ffffff4d 50%, transparent 51%);
  animation: drift 60s linear infinite; opacity:.35;
}
.particles::after{ animation-duration: 90s; opacity:.25; }
@keyframes drift{ from{ transform:translate3d(0,0,0)} to{ transform:translate3d(0,-8%,0)} }

/* ===== Хедер (исправленный для мобильных) ===== */
.site-header {
  position: static;
  width: 100vw;
  left: 0;
  margin-left: calc(-50vw + 50%);
  background: linear-gradient(180deg, rgba(6,8,20,0.4), rgba(6,8,20,0.25)) fixed;
  background-size: 100% 100%;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  backdrop-filter: saturate(140%) blur(12px);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  padding: 14px clamp(16px, 3.2vw, 32px);
  box-sizing: border-box;
}

/* Гарантированное растяжение фона */
.site-header::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100vw;
  right: -100vw;
  bottom: 0;
  background: inherit;
  z-index: -1;
}

.brand{ display:flex; align-items:center; gap:14px; }

/* ЛОГОТИП — без свечения */
.logo-img{
  height: var(--logo-h);
  width:auto; display:block; object-fit:contain; image-rendering:auto;
  border-radius:6px;
  filter: none !important;
  box-shadow: none !important;
}
.logo{ display:none !important; }
.brand::before{ content:none !important; }

.brand-title{ font-size:clamp(18px,2.8vw,28px); font-weight:800; letter-spacing:.2px; }
.brand-sub{ font-size:19px; opacity:.33; margin-top:-11px; }

.actions{ display:flex; align-items:center; gap:10px; }
.search{ position:relative; display:flex; align-items:center; gap:6px; }
.search input{
  width:min(44vw,360px);
  background:var(--panel); border:1px solid var(--panel-border); color:var(--ink);
  border-radius:12px; padding:10px 36px 10px 12px; outline:0;
  backdrop-filter: blur(var(--panel-blur));
  box-shadow: 0 6px 24px #00000033 inset, 0 1px 0 #ffffff30 inset;
  font-size:14px;
}
.icon-btn{ border:0; background:transparent; color:var(--muted); cursor:pointer; padding:6px; border-radius:8px; }
.icon-btn:hover{ color:var(--ink); background:#ffffff10 }
.search #clearSearch{ position:absolute; right:6px; }

.btn{
  border:1px solid var(--panel-border);
  background:linear-gradient(180deg,#ffffff15,#00000005);
  color:var(--ink); padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer;
  transition:.2s transform, .2s box-shadow;
  box-shadow: 0 8px 18px #00000026, 0 1px 0 #ffffff30 inset;
}
.btn:hover{ transform:translateY(-1px) }
.btn.ghost{ background:transparent }

/* ===== Разметка ===== */
.layout{
  display:grid; grid-template-columns: 280px 1fr; gap:24px;
  max-width:1400px; margin:28px auto; padding:0 18px;
  overflow:visible;
}
.wrap{ max-width:var(--maxw); margin:0 auto; }

/* ===== Оглавление (TOC) ===== */
.toc{
  position:sticky; top:16px;
  align-self:start;
  z-index:30;
}
.toc-inner{
  background:var(--panel); border:1px solid var(--panel-border); border-radius:16px; padding:14px;
  backdrop-filter: blur(var(--panel-blur));
  box-shadow:0 10px 24px #00000026, 0 1px 0 #ffffff22 inset;
}
.toc-title{ font-weight:800; margin-bottom:8px; letter-spacing:.3px }
.toc-nav{ display:flex; flex-direction:column; gap:2px; }

.toc-nav a{
  display:flex; align-items:center; gap:8px;
  padding:10px 12px;
  border-radius:12px;
  text-decoration:none;
  color:var(--muted);
  border:1px solid transparent;
  transition:
    background .22s ease,
    border-color .22s ease,
    box-shadow .22s ease,
    transform .12s ease;
}
.toc-nav a .idx{ font-family:"JetBrains Mono", ui-monospace, monospace; opacity:.7 }
.toc-nav a:hover{
  color:var(--ink);
  background:linear-gradient(180deg,#ffffff14,#00000008);
  border-color:#ffffff18;
  box-shadow:0 10px 18px #00000024 inset, 0 0 0 1px #ffffff10 inset;
  transform:translateX(2px);
}
.toc-nav a.active{
  color:var(--ink);
  border-color:#ffffff22;
  background:linear-gradient(180deg,#ffffff18,#0000000a);
  box-shadow:0 8px 16px #00000020 inset, 0 0 0 1px #ffffff12 inset;
}

/* ===== Индикатор чтения ===== */
.reading-progress{
  position:fixed; right:14px; top:16px;
  width:6px; height:calc(100dvh - 48px);
  border-radius:999px; background:#ffffff14; overflow:hidden; z-index:5;
}
.reading-progress .bar{
  display:block; width:100%; height:0%;
  background:linear-gradient(180deg,var(--primary),var(--accent));
  box-shadow:0 0 14px var(--primary);
}

/* ===== Аккордеон ===== */
.accordion{
  counter-reset:cat;
  background:var(--panel); border:1px solid var(--panel-border); border-radius:20px;
  padding:8px 16px 18px;
  backdrop-filter: blur(var(--panel-blur));
  box-shadow:0 10px 28px #00000033, 0 1px 0 #ffffff22 inset;
  position:relative;
}
.acc-item{ border-bottom:1px dashed #ffffff22; padding:12px 0; counter-increment:cat; }
.acc-item:last-child{ border-bottom:0 }

.acc-summary{
  position:relative; width:100%; display:flex; align-items:center; gap:12px;
  cursor:pointer; user-select:none; padding:12px 14px 12px 22px;
  border:0; background:transparent; text-align:left; border-radius:14px;
  transition: background-color .22s ease, transform .06s ease, box-shadow .2s ease;
}
.acc-summary:hover{ background:#ffffff0f; }
.acc-summary:active{ transform:translateY(0.5px) }
.acc-summary:focus-visible{ outline:2px solid #c7d2fe; outline-offset:3px; border-radius:14px; }

/* Левая полоса */
.acc-summary::before{
  content:""; position:absolute; left:8px; top:10px; bottom:10px; width:4px; border-radius:3px;
  background:linear-gradient(180deg,var(--primary),var(--accent));
  transform:scaleY(0); transform-origin:top; transition:transform .25s ease; opacity:.95;
  box-shadow:none !important;
}
.acc-item.active .acc-summary::before{ transform:scaleY(1); box-shadow:none !important; }

.cat-num::before{
  content: counter(cat) ".";
  font-weight:800; color:var(--primary);
  font-size:clamp(18px,2.2vw,24px);
  min-width:32px; display:inline-block;
  text-shadow:none !important;
}
.cat-title{ font-weight:800; letter-spacing:.2px; font-size:clamp(18px,2.2vw,26px); color:var(--ink); text-shadow:none !important; }

.acc-tools{ margin-left:auto; display:flex; align-items:center; gap:6px; }
.copy-link{ opacity:.7 }
/* Стили для кнопки копирования */
.copy-link.copied {
  color: var(--ok) !important;
  opacity: 1 !important;
}
/* Всплывающее уведомление */
.copy-tooltip {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--panel);
  border: 1px solid var(--ok);
  color: var(--ok);
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
  margin-bottom: 5px;
  animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateX(-50%) translateY(5px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

.acc-icon{ margin-left:6px; width:18px; height:18px; position:relative; flex-shrink:0; }
.acc-icon::before,.acc-icon::after{
  content:""; position:absolute; inset:0; margin:auto;
  width:14px; height:2px; background:#c5c9e8; border-radius:2px;
  transition: transform .2s ease, opacity .2s ease, background .2s ease;
}
.acc-icon::after{ transform:rotate(90deg) }
.acc-item.active .acc-icon::after{ transform:rotate(0); opacity:0 }
.acc-item.active .acc-icon::before{ background:var(--primary) }

.acc-panel{
  overflow:hidden; overflow-anchor:none; max-height:0; opacity:0;
  margin-top:12px;
  background:var(--panel-soft); border:1px solid var(--panel-border); border-radius:16px;
  padding:0 24px;
  transition:max-height .35s ease, opacity .25s ease, padding .25s ease, box-shadow .25s ease;
  box-shadow:0 8px 22px #0000002c inset, 0 0 0 1px #ffffff0f inset;
}
.acc-item.active .acc-panel{ opacity:1; padding:22px 24px; }

/* ===== Нумерованные пункты ===== */
.points{ margin:0; padding:0; list-style:none; counter-reset:item; }
.points>li{
  counter-increment:item;
  position:relative; padding-left:56px; margin:18px 0;
  color:#d7defa; font-size:clamp(14px,1.4vw,18px);
}
.points>li::before{
  content: counter(cat) "." counter(item);
  position:absolute; left:0; top:0.05em; width:48px;
  font-weight:800; color:#ffffff; opacity:.45;
}

/* ===== Тексты / футер ===== */
a{ color:#9db2ff; text-decoration:underline }
.muted{ color:var(--muted); display:block; margin-top:4px }
.warn{ color:#ff9797; display:block; margin-top:4px; font-weight:500 }
.warn b{ font-weight:800 }

.site-foot{ margin:28px 0 8px; }
.foot-inner{ display:flex; gap:8px; align-items:center; color:var(--muted); }
.kbd{
  font-family:"JetBrains Mono", ui-monospace, monospace;
  background:#ffffff10; border:1px solid #ffffff25; padding:2px 6px; border-radius:6px; font-size:12px;
}

/* ===== Подсветка найденного правила по коду ===== */
.points > li.mg-hit{
  position:relative;
  padding-left:56px;
  background:linear-gradient(180deg,#ffffff10,#00000008);
  border-radius:12px;
}
.points > li.mg-hit::before{
  color:#ffbf3b !important;
  text-shadow:0 0 16px #ffbf3b66;
}
.points > li.mg-hit::after{
  content:""; position:absolute; top:-6px; bottom:-6px; right:-6px; left:52px;
  border:2px solid #ffbf3b66; border-radius:14px; pointer-events:none;
}
.acc-item.mg-hit .cat-title{ text-shadow:0 0 18px #7aa2ff55; }
.mg-bad{ animation: mg-bad .45s ease }
@keyframes mg-bad{ 0%{box-shadow:0 0 0 0 #ff5e5e} 50%{box-shadow:0 0 0 4px #ff5e5e} 100%{box-shadow:0 0 0 0 #ff5e5e} }

/* Скрытие скроллбаров */
html, body { scrollbar-width:none; }
body { -ms-overflow-style:none; }
html::-webkit-scrollbar, body::-webkit-scrollbar{ width:0 !important; height:0 !important; }
html::-webkit-scrollbar-thumb, body::-webkit-scrollbar-thumb,
html::-webkit-scrollbar-track, body::-webkit-scrollbar-track{ background:transparent !important; }

/* ========== АДАПТИВ ========== */
@media (max-width:980px){
  .layout{ grid-template-columns:1fr; }
  .toc{ order:-1 }
  .toc-inner{ position:relative }
  :root{ --logo-h: clamp(20px, 5vw, 28px); } 
}

@media (max-width:768px){
  /* Хедер на мобильных */
  .site-header {
    padding: 14px 16px;
    flex-wrap: wrap;
  }
  
  .brand {
    width: 100%;
    justify-content: center;
    margin-bottom: 10px;
  }
  
  .actions {
    width: 100%;
    justify-content: center;
    flex-wrap: wrap;
  }
  
  .search input {
    width: 100%;
    max-width: 100%;
  }
  
  /* Оглавление скрыто на мобильных */
  .toc {
    display: none;
  }
  
  /* Аккордеон */
  .acc-panel {
    padding: 0 16px;
  }
  .acc-item.active .acc-panel {
    padding: 16px;
  }
  
  .points>li {
    padding-left: 44px;
    font-size: 15px;
  }
  .points>li::before {
    width: 40px;
  }
  
  /* Индикатор чтения скрыт */
  .reading-progress {
    display: none;
  }
}

@media (max-width:560px){
  .actions{ gap:6px; flex-direction: column; }
  .btn{ width: 100%; text-align: center; }
  .search{ width: 100%; }
  
  .acc-summary {
    flex-wrap: wrap;
    gap: 8px;
    padding: 12px 8px;
  }
  
  .cat-title {
    font-size: 18px;
  }
  
  .acc-tools {
    margin-left: 0;
    width: 100%;
    justify-content: flex-end;
  }
  
  .brand-title {
    text-align: center;
  }
  
  .brand-sub {
    text-align: center;
    font-size: 16px;
  }
}

.acc-summary {
  transition: background-color .22s ease, transform .06s ease, box-shadow .2s ease;
  position: relative;
}

/* Добавляем индикатор загрузки при анимации */
.acc-summary::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--primary);
  transform: scaleX(0);
  transform-origin: left;
  transition: transform .3s ease;
  opacity: 0;
}

.acc-item.animating .acc-summary::after {
  opacity: 1;
  transform: scaleX(1);
  transition-duration: .5s;
}

/* Исправления для мобильной версии */
@media (max-width: 768px) {
  /* Уменьшаем отступы и корректируем позиционирование градиентной полосы */
  .acc-summary {
    padding-left: 16px; /* Уменьшаем отступ слева */
  }
  
  .acc-summary::before {
    left: 4px; /* Сдвигаем полосу ближе к краю */
    width: 3px; /* Делаем полосу тоньше */
  }
  
  /* Уменьшаем отступы для пунктов списка */
  .points > li {
    padding-left: 36px; /* Уменьшаем отступ для цифр */
  }
  
  .points > li::before {
    width: 32px; /* Уменьшаем место для цифр */
    font-size: 14px; /* Уменьшаем размер цифр */
  }
  
  /* Корректируем отступы в открытых панелях */
  .acc-panel {
    padding: 0 12px !important;
  }
  
  .acc-item.active .acc-panel {
    padding: 16px 12px !important;
  }
  
  /* Делаем заголовки более компактными */
  .cat-title {
    font-size: 16px;
    line-height: 1.3;
  }
  
  .cat-num::before {
    font-size: 16px;
    min-width: 24px;
  }
}

/* Дополнительные исправления для очень маленьких экранов */
@media (max-width: 480px) {
  .acc-summary {
    padding-left: 14px;
    gap: 6px;
  }
  
  .points > li {
    padding-left: 30px;
    font-size: 14px;
  }
  
  .points > li::before {
    width: 26px;
    font-size: 12px;
  }
  
  /* Корректируем позицию инструментов */
  .acc-tools {
    position: absolute;
    right: 8px;
    top: 8px;
  }
}